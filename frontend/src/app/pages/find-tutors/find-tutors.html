<div class="find-root">
  <div class="card shadow-sm mb-4 p-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div>
        <h2 class="dashboard-title mb-1">Find a Tutor</h2>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-12 col-md-8">
        <input type="text" class="form-control" placeholder="Search by name, subject, or expertise..." [(ngModel)]="search" (input)="doFilter()" />
      </div>
      <div class="col-12 col-md-4">
        <div class="custom-select-wrapper position-relative">
          <i class="bi bi-filter-left select-icon" aria-hidden="true"></i>
          <select class="form-select custom-subject" [(ngModel)]="selectedSubject" (change)="doFilter()">
            <option value="">All Subjects</option>
            <option value="Biology">Biology</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Computer Science">Computer Science</option>
            <option value="Economics">Economics</option>
            <option value="English">English</option>
            <option value="History">History</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Physics">Physics</option>
            <option *ngFor="let s of subjects" [value]="s">{{ s }}</option>
          </select>
        </div>
      </div>
    </div>
    <div class="mt-3 small text-secondary">Showing {{ filtered.length }} of {{ tutors.length }} tutors</div>
  </div>

  <div class="row g-4">
      <div class="col-12" *ngFor="let t of filtered">
      <app-tutor-card [tutor]="t" [subjects]="t.subjects" [avgRating]="t.avgRating" [ratingCount]="t.ratingCount" (onBook)="openBooking($event)"></app-tutor-card>
    </div>
  </div>

  <!-- Booking Modal Overlay -->
  <div class="modal-backdrop" *ngIf="bookingTutorId">
    <div class="booking-modal card p-4 shadow">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center gap-2">
          <div class="modal-icon">ðŸ“…</div>
          <div class="fw-semibold h5 mb-0">Book Session</div>
        </div>
        <button class="btn btn-link" (click)="bookingTutorId = null"><i class="bi bi-x-lg"></i></button>
      </div>

      <div class="mb-3">
        <label class="form-label small">Subject</label>
        <select class="form-select" [(ngModel)]="bookSubject">
          <option *ngFor="let s of (selectedTutorSubjects || subjects || [])" [value]="s">{{ s }}</option>
        </select>
      </div>





      <div class="mb-3">
        <label class="form-label small">Notes (optional)</label>
        <textarea class="form-control" rows="3" [(ngModel)]="bookNotes" placeholder="Any specific topics or questions?"></textarea>
      </div>

      <div *ngIf="bookingError" class="text-danger small mb-2">{{ bookingError }}</div>

      <div class="mb-3">
        <label class="form-label small">Available slots</label>
        <div *ngIf="slots.length>0">
          <div *ngFor="let s of slots" class="card p-2 mb-2 d-flex justify-content-between align-items-center">
            <div>
              <input type="radio" name="slot" [value]="s._id" [(ngModel)]="selectedSlot" [ngModelOptions]="{standalone:true}" />
              <span class="ms-2">{{ s.startAt | date:'mediumDate' }} Â· {{ s.startAt | date:'shortTime' }} - {{ s.endAt | date:'shortTime' }} ({{ s.durationMinutes }}m)</span>
            </div>
          </div>
        </div>
        <div *ngIf="slots.length===0" class="text-muted">No available slots</div>
      </div>

      <div class="d-flex gap-3 justify-content-end mt-3">
        <button class="btn btn-outline-secondary" (click)="bookingTutorId = null" [disabled]="bookingInProgress">Cancel</button>
        <button class="btn btn-primary" (click)="confirmBooking()" [disabled]="bookingInProgress || slots.length===0 || !selectedSlot">
          <span *ngIf="bookingInProgress" class="spinner-border spinner-border-sm me-2" role="status"></span>
          Confirm Booking
        </button>
      </div>
    </div>
  </div>
</div>
